<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Ball Sort Puzzle</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Arial', sans-serif;
            overflow-x: hidden;
        }
        
        .game-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .tube {
            width: 60px;
            height: 240px;
            border: 4px solid #333;
            border-radius: 0 0 30px 30px;
            background: rgba(255, 255, 255, 0.1);
            margin: 10px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
            padding: 4px;
        }
        
        .tube:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .tube.selected {
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
        }
        
        .ball {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            margin: 2px 0;
            border: 2px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.3), 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .ball:hover {
            transform: scale(1.1);
        }
        
        .ball.selected {
            transform: scale(1.2);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
            animation: glow 1s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(255, 255, 255, 0.8); }
            to { box-shadow: 0 0 30px rgba(255, 255, 255, 1); }
        }
        
        .color-red { background: linear-gradient(135deg, #ff416c, #ff4757); }
        .color-blue { background: linear-gradient(135deg, #4834d4, #667eea); }
        .color-green { background: linear-gradient(135deg, #00d2d3, #54a0ff); }
        .color-yellow { background: linear-gradient(135deg, #feca57, #ff9ff3); }
        .color-purple { background: linear-gradient(135deg, #a55eea, #26de81); }
        .color-orange { background: linear-gradient(135deg, #fd79a8, #fdcb6e); }
        
        .game-header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .btn {
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            margin: 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .btn-hint {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }
        
        .btn-reset {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
        }
        
        .tubes-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin: 30px 0;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .ad-placeholder {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 40px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            animation: adPulse 2s ease-in-out infinite;
        }
        
        @keyframes adPulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }
        
        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #ffd700;
            animation: confetti-fall 3s linear infinite;
        }
        
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        .instruction-text {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Game Header -->
        <div class="game-header">
            <h1 class="text-4xl font-bold text-white mb-4">
                <i class="fas fa-circle text-red-500"></i> Ball Sort Puzzle
            </h1>
            <div class="flex justify-center items-center gap-6 text-white">
                <div class="flex items-center gap-2">
                    <i class="fas fa-layer-group"></i>
                    <span>Level: <span id="level">1</span></span>
                </div>
                <div class="flex items-center gap-2">
                    <i class="fas fa-clock"></i>
                    <span id="timer">00:00</span>
                </div>
                <div class="flex items-center gap-2">
                    <i class="fas fa-star"></i>
                    <span id="score">0</span>
                </div>
            </div>
        </div>
        
        <!-- Instructions -->
        <div class="instruction-text">
            <i class="fas fa-hand-pointer text-purple-600"></i>
            <span id="instruction">Tap a ball to select it, then tap a tube to move it there</span>
        </div>
        
        <!-- Control Buttons -->
        <div class="flex justify-center gap-4 mb-6">
            <button class="btn btn-hint" id="hintBtn">
                <i class="fas fa-lightbulb"></i> Hint
            </button>
            <button class="btn btn-reset" id="resetBtn">
                <i class="fas fa-redo"></i> Reset
            </button>
        </div>
        
        <!-- Game Board -->
        <div class="tubes-container" id="tubesContainer">
            <!-- Tubes will be generated here -->
        </div>
    </div>
    
    <!-- How to Play Modal -->
    <div class="modal" id="howToPlayModal">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4 text-purple-600">
                <i class="fas fa-target"></i> How to Play
            </h2>
            <div class="text-left space-y-3">
                <div class="flex items-center gap-3">
                    <i class="fas fa-circle text-blue-500"></i>
                    <span>Sort all balls by color into separate tubes</span>
                </div>
                <div class="flex items-center gap-3">
                    <i class="fas fa-hand-pointer text-green-500"></i>
                    <span>Tap a ball to select it (it will glow)</span>
                </div>
                <div class="flex items-center gap-3">
                    <i class="fas fa-arrow-right text-orange-500"></i>
                    <span>Tap a destination tube to move the ball</span>
                </div>
                <div class="flex items-center gap-3">
                    <i class="fas fa-layer-group text-purple-500"></i>
                    <span>Only the top ball in each tube can be moved</span>
                </div>
                <div class="flex items-center gap-3">
                    <i class="fas fa-sort-numeric-up text-pink-500"></i>
                    <span>Each tube holds a maximum of 4 balls</span>
                </div>
                <div class="flex items-center gap-3">
                    <i class="fas fa-lightbulb text-yellow-500"></i>
                    <span>Use hints when you get stuck</span>
                </div>
            </div>
            <button class="btn" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; margin-top: 20px;" id="startBtn">
                <i class="fas fa-rocket"></i> Start Playing!
            </button>
        </div>
    </div>
    
    <!-- Level Complete Modal -->
    <div class="modal" id="levelCompleteModal" style="display: none;">
        <div class="modal-content">
            <h2 class="text-3xl font-bold mb-4 text-green-600">
                <i class="fas fa-trophy"></i> Level Complete!
            </h2>
            <p class="text-lg mb-4">Congratulations! You've completed level <span id="completedLevel">1</span>!</p>
            <div class="ad-placeholder">
                <i class="fas fa-play-circle text-4xl mb-3"></i>
                <h3 class="text-xl font-bold mb-2">Watch Ad to Continue</h3>
                <p class="mb-4">Support the game and unlock the next level!</p>
                <button class="btn" style="background: white; color: #667eea;" id="watchAdBtn">
                    <i class="fas fa-play"></i> Watch Ad (5s)
                </button>
            </div>
        </div>
    </div>
    
    <!-- Hint Modal -->
    <div class="modal" id="hintModal" style="display: none;">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4 text-orange-600">
                <i class="fas fa-lightbulb"></i> Need a Hint?
            </h2>
            <p class="text-lg mb-4">Watch an ad to get a helpful hint!</p>
            <div class="ad-placeholder">
                <i class="fas fa-play-circle text-4xl mb-3"></i>
                <h3 class="text-xl font-bold mb-2">Watch Ad for Hint</h3>
                <p class="mb-4">Get strategic guidance to solve the puzzle!</p>
                <div class="flex gap-3 justify-center">
                    <button class="btn" style="background: #667eea; color: white;" id="watchHintAdBtn">
                        <i class="fas fa-play"></i> Watch Ad
                    </button>
                    <button class="btn" style="background: #ccc; color: #333;" id="cancelHintBtn">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Ad Playing Modal -->
    <div class="modal" id="adModal" style="display: none;">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4">
                <i class="fas fa-tv"></i> Advertisement
            </h2>
            <div class="ad-placeholder">
                <i class="fas fa-spinner fa-spin text-4xl mb-3"></i>
                <h3 class="text-xl font-bold mb-2">Playing Ad...</h3>
                <p class="mb-4">Please wait <span id="adTimer">5</span> seconds</p>
                <div class="w-full bg-gray-200 rounded-full h-2">
                    <div class="bg-blue-600 h-2 rounded-full transition-all duration-1000" id="adProgress" style="width: 0%"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Celebration Effect -->
    <div class="celebration" id="celebration"></div>

    <script>
        class BallSortPuzzle {
            constructor() {
                this.level = 1;
                this.score = 0;
                this.startTime = Date.now();
                this.selectedBall = null;
                this.selectedTube = null;
                this.tubes = [];
                this.gameStarted = false;
                this.adWatched = false;
                
                this.colors = ['red', 'blue', 'green', 'yellow', 'purple', 'orange'];
                this.maxBallsPerTube = 4;
                
                this.initializeEventListeners();
                this.updateTimer();
            }
            
            initializeEventListeners() {
                document.getElementById('startBtn').addEventListener('click', () => this.startGame());
                document.getElementById('hintBtn').addEventListener('click', () => this.showHintModal());
                document.getElementById('resetBtn').addEventListener('click', () => this.resetLevel());
                document.getElementById('watchAdBtn').addEventListener('click', () => this.playAd('levelComplete'));
                document.getElementById('watchHintAdBtn').addEventListener('click', () => this.playAd('hint'));
                document.getElementById('cancelHintBtn').addEventListener('click', () => this.hideModal('hintModal'));
            }
            
            startGame() {
                this.gameStarted = true;
                this.hideModal('howToPlayModal');
                this.generateLevel();
                this.startTime = Date.now();
            }
            
            generateLevel() {
                this.tubes = [];
                const numColors = Math.min(3 + Math.floor(this.level / 2), 6);
                const numTubes = numColors + 2; // Extra empty tubes
                
                // Initialize tubes
                for (let i = 0; i < numTubes; i++) {
                    this.tubes.push([]);
                }
                
                // Fill tubes with balls
                const ballsPerColor = this.maxBallsPerTube;
                let allBalls = [];
                
                for (let i = 0; i < numColors; i++) {
                    for (let j = 0; j < ballsPerColor; j++) {
                        allBalls.push(this.colors[i]);
                    }
                }
                
                // Shuffle balls
                for (let i = allBalls.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [allBalls[i], allBalls[j]] = [allBalls[j], allBalls[i]];
                }
                
                // Distribute balls to tubes (except last 2 which stay empty)
                let ballIndex = 0;
                for (let i = 0; i < numTubes - 2; i++) {
                    for (let j = 0; j < this.maxBallsPerTube; j++) {
                        if (ballIndex < allBalls.length) {
                            this.tubes[i].push(allBalls[ballIndex]);
                            ballIndex++;
                        }
                    }
                }
                
                this.renderGame();
            }
            
            renderGame() {
                const container = document.getElementById('tubesContainer');
                container.innerHTML = '';
                
                this.tubes.forEach((tube, tubeIndex) => {
                    const tubeElement = document.createElement('div');
                    tubeElement.className = 'tube';
                    tubeElement.addEventListener('click', () => this.onTubeClick(tubeIndex));
                    
                    tube.forEach((color, ballIndex) => {
                        const ball = document.createElement('div');
                        ball.className = `ball color-${color}`;
                        ball.addEventListener('click', (e) => {
                            e.stopPropagation();
                            this.onBallClick(tubeIndex, ballIndex);
                        });
                        tubeElement.appendChild(ball);
                    });
                    
                    container.appendChild(tubeElement);
                });
                
                this.updateUI();
            }
            
            onBallClick(tubeIndex, ballIndex) {
                if (!this.gameStarted) return;
                
                // Can only select the top ball
                if (ballIndex !== this.tubes[tubeIndex].length - 1) return;
                
                this.clearSelections();
                this.selectedBall = { tubeIndex, ballIndex };
                this.selectedTube = tubeIndex;
                
                this.renderSelections();
                this.updateInstruction('Now tap a tube to move the ball there');
            }
            
            onTubeClick(tubeIndex) {
                if (!this.gameStarted || !this.selectedBall) return;
                
                if (tubeIndex === this.selectedBall.tubeIndex) {
                    // Clicking same tube - deselect
                    this.clearSelections();
                    this.updateInstruction('Tap a ball to select it, then tap a tube to move it there');
                    return;
                }
                
                if (this.canMoveBall(this.selectedBall.tubeIndex, tubeIndex)) {
                    this.moveBall(this.selectedBall.tubeIndex, tubeIndex);
                    this.clearSelections();
                    
                    if (this.checkLevelComplete()) {
                        this.completeLevel();
                    } else {
                        this.updateInstruction('Great move! Select another ball to continue');
                    }
                } else {
                    this.updateInstruction('Cannot move there! Try a different tube');
                }
            }
            
            canMoveBall(fromTube, toTube) {
                if (this.tubes[toTube].length >= this.maxBallsPerTube) return false;
                if (this.tubes[fromTube].length === 0) return false;
                
                const movingBall = this.tubes[fromTube][this.tubes[fromTube].length - 1];
                const topBall = this.tubes[toTube][this.tubes[toTube].length - 1];
                
                return this.tubes[toTube].length === 0 || movingBall === topBall;
            }
            
            moveBall(fromTube, toTube) {
                const ball = this.tubes[fromTube].pop();
                this.tubes[toTube].push(ball);
                this.score += 10;
                this.renderGame();
            }
            
            clearSelections() {
                this.selectedBall = null;
                this.selectedTube = null;
                this.renderSelections();
            }
            
            renderSelections() {
                document.querySelectorAll('.ball').forEach(ball => ball.classList.remove('selected'));
                document.querySelectorAll('.tube').forEach(tube => tube.classList.remove('selected'));
                
                if (this.selectedBall) {
                    const tubes = document.querySelectorAll('.tube');
                    const selectedTube = tubes[this.selectedBall.tubeIndex];
                    const balls = selectedTube.querySelectorAll('.ball');
                    if (balls[this.selectedBall.ballIndex]) {
                        balls[this.selectedBall.ballIndex].classList.add('selected');
                    }
                    selectedTube.classList.add('selected');
                }
            }
            
            checkLevelComplete() {
                for (let tube of this.tubes) {
                    if (tube.length > 0) {
                        const firstColor = tube[0];
                        if (tube.length !== this.maxBallsPerTube || !tube.every(ball => ball === firstColor)) {
                            return false;
                        }
                    }
                }
                return true;
            }
            
            completeLevel() {
                this.gameStarted = false;
                this.score += this.level * 100;
                this.showCelebration();
                this.showModal('levelCompleteModal');
                document.getElementById('completedLevel').textContent = this.level;
            }
            
            showCelebration() {
                const celebration = document.getElementById('celebration');
                celebration.innerHTML = '';
                
                for (let i = 0; i < 50; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.backgroundColor = ['#ff416c', '#4834d4', '#00d2d3', '#feca57', '#a55eea', '#fd79a8'][Math.floor(Math.random() * 6)];
                    confetti.style.animationDelay = Math.random() * 3 + 's';
                    celebration.appendChild(confetti);
                }
                
                setTimeout(() => {
                    celebration.innerHTML = '';
                }, 3000);
            }
            
            showHintModal() {
                if (!this.gameStarted) return;
                this.showModal('hintModal');
            }
            
            playAd(type) {
                this.hideModal(type === 'levelComplete' ? 'levelCompleteModal' : 'hintModal');
                this.showModal('adModal');
                
                let countdown = 5;
                const adTimer = document.getElementById('adTimer');
                const adProgress = document.getElementById('adProgress');
                
                const timer = setInterval(() => {
                    countdown--;
                    adTimer.textContent = countdown;
                    adProgress.style.width = ((5 - countdown) / 5) * 100 + '%';
                    
                    if (countdown <= 0) {
                        clearInterval(timer);
                        this.hideModal('adModal');
                        this.adWatched = true;
                        
                        if (type === 'levelComplete') {
                            this.nextLevel();
                        } else if (type === 'hint') {
                            this.showHint();
                        }
                    }
                }, 1000);
            }
            
            showHint() {
                // Find a possible move
                for (let fromTube = 0; fromTube < this.tubes.length; fromTube++) {
                    if (this.tubes[fromTube].length === 0) continue;
                    
                    for (let toTube = 0; toTube < this.tubes.length; toTube++) {
                        if (fromTube === toTube) continue;
                        
                        if (this.canMoveBall(fromTube, toTube)) {
                            const tubes = document.querySelectorAll('.tube');
                            tubes[fromTube].style.border = '4px solid #ffd700';
                            tubes[toTube].style.border = '4px solid #00ff00';
                            
                            this.updateInstruction(`Hint: Move ball from tube ${fromTube + 1} to tube ${toTube + 1}`);
                            
                            setTimeout(() => {
                                tubes[fromTube].style.border = '4px solid #333';
                                tubes[toTube].style.border = '4px solid #333';
                            }, 3000);
                            return;
                        }
                    }
                }
                
                this.updateInstruction('No moves available - try resetting the level!');
            }
            
            nextLevel() {
                this.level++;
                this.adWatched = false;
                this.generateLevel();
                this.startTime = Date.now();
                this.gameStarted = true;
                this.updateInstruction('New level! Sort all balls by color');
            }
            
            resetLevel() {
                if (!confirm('Are you sure you want to reset this level?')) return;
                this.generateLevel();
                this.clearSelections();
                this.updateInstruction('Level reset! Tap a ball to select it');
            }
            
            updateTimer() {
                if (this.gameStarted) {
                    const elapsed = Math.floor((Date.now() - this.startTime) / 1000);
                    const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
                    const seconds = (elapsed % 60).toString().padStart(2, '0');
                    document.getElementById('timer').textContent = `${minutes}:${seconds}`;
                }
                setTimeout(() => this.updateTimer(), 1000);
            }
            
            updateUI() {
                document.getElementById('level').textContent = this.level;
                document.getElementById('score').textContent = this.score;
            }
            
            updateInstruction(text) {
                document.getElementById('instruction').textContent = text;
            }
            
            showModal(modalId) {
                document.getElementById(modalId).style.display = 'flex';
            }
            
            hideModal(modalId) {
                document.getElementById(modalId).style.display = 'none';
            }
        }
        
        // Initialize game when page loads
        window.addEventListener('DOMContentLoaded', () => {
            new BallSortPuzzle();
        });
    </script>
</body>
</html>
